"use strict";function objectToParams(a){var e=Object.keys(a);e.sort();var t="";return e.forEach(function(e){a[e]&&(t+="&"+e+"="+a[e])}),t.substring(1)}function addPageNum(a){var e={categories:categoryquery,tags:tagquery,search:searchquery,per_page:"5",sticky:"true",page:a};$("#pagination").append("<a class='page-num' id='page-"+a+"' href='?"+objectToParams(e)+"'><button class='btn btn-primary'>"+a+"</button></a>")}var tagsPromise,authorPromise,postsPromise,tagquery,categoryquery,posts={},authors={},tags={},cats={},js_tagsArr=[],js_catsArr=[],searchquery="",pageQuery="",filterCategories=[];""!==js_tags&&(tagquery=js_tags,js_tagsArr=js_tags.split(",")),""!==js_categories&&(categoryquery=js_categories),""!==js_searchKey&&(searchquery=js_searchKey),""!==js_page&&(pageQuery=js_page);var totalPages,page=1,searchedTags=js_tags.split(","),cachemethod="default",c0="wp-json/wp/v2/categories";cachemethod=cacheable["/"+c0]||cacheable["/blog/"+c0]?"force-cache":"default";var ha=new Headers;ha.append("Cache-Control","public, max-age=1200");var catsPromise=fetch(wp_endpoint+c0,{headers:ha}).then(function(a){return a.json()}),excludedLangs=allSiteLangs,excludedLangsArr=excludedLangs=excludedLangs.filter(function(a){return a!=siteLang}).map(function(a){return siteLangMap[a]}),paramsStickyPost={categories_exclude:(excludedLangs=excludedLangs.join(","))+","+externalNewsCategory,categories:categoryquery,tags:tagquery,search:searchquery,per_page:"5",sticky:"true"},c1="wp-json/wp/v2/posts?"+objectToParams(paramsStickyPost);cachemethod=cacheable["/"+c1]||cacheable["/blog/"+c1]?"force-cache":"default";var stickyPostsPromise=fetch(wp_endpoint+c1,{headers:ha}).then(function(a){return a.json()}),paramsPost={categories_exclude:excludedLangs+","+externalNewsCategory,categories:categoryquery,tags:tagquery,search:searchquery,per_page:"5",page:pageQuery},c2="wp-json/wp/v2/posts?"+objectToParams(paramsPost);cachemethod=cacheable["/"+c2]||cacheable["/blog/"+c2]?"force-cache":"default",postsPromise=fetch(wp_endpoint+c2,{headers:ha}).then(function(a){var e=a.headers;return totalPages=parseInt(e.get("X-WP-TotalPages")),""!==js_page&&(page=parseInt(js_page)),a.json()});var c3="wp-json/wp/v2/users";cachemethod=cacheable["/"+c3]||cacheable["/blog/"+c3]?"force-cache":"default",$(document).ready(function(){$("#blog-href").addClass("active"),$("#long-email").on("focus",function(){$(document).off("keypress"),$(document).keypress(function(a){if(13==a.which)return $("#long-form-submit").click(),!1})}),$("#searchKey").on("focus",function(){$(document).off("keypress"),$(document).keypress(function(a){if(13==a.which)return search(),!1})});var a=[catsPromise,postsPromise,stickyPostsPromise];Promise.all(a).then(function(a){var e=js_categories.split(",");a[0].forEach(function(a){cats[a.id]=a;for(var t=!1,s=0;s<e.length;s++)if(a.id==parseInt(e[s])){t=!0;break}addTag(a.id,t)}),e.forEach(function(a){$("#tag-"+a).addClass("selected")}),posts=a[1];var t=a[2];if(void 0==t&&(t=[]),isNaN(totalPages))return $(".blank-placeholder-posts").css("display","none"),void $("#posts-list").append("<h3>没有帖子。点击<a l href='../blog'>这里</a>回博客主页</h3>");var s=0;if(posts.length>0){if(posts.forEach(function(a){authors[a.author]?(s+=1)==posts.length&&(posts.forEach(function(a){addPost(a)}),$(".blank-placeholder-posts").css("display","none")):fetch(wp_endpoint+c3+"/"+a.author,{headers:ha}).then(function(a){return a.json()}).then(function(a){return authors[a.id]=a}).then(function(a){(s+=1)==posts.length&&(posts.forEach(function(a){addPost(a)}),$(".blank-placeholder-posts").css("display","none"))})}),page>1&&1!=totalPages){var o={categories:categoryquery,tags:tagquery,search:searchquery,per_page:"5",sticky:"true",page:page-1};$("#pagination").append("<a class='page-num' id='page-"+(page-1)+"' href='?"+objectToParams(o)+"'><button class='btn btn-primary'>上</button></a>")}if(totalPages<=7)for(var r=1;r<totalPages+1;r++)addPageNum(r);else if(page==totalPages){addPageNum(1),addPageNum(2),$("#pagination").append("<a class='ellipsis'>...</a>");for(var n=totalPages-3;n<=totalPages;n++)addPageNum(n)}else if(page<totalPages-3&&page>3){addPageNum(1),addPageNum(2),$("#pagination").append("<a class='ellipsis'>...</a>");for(var c=page-1;c<=page+1;c++)addPageNum(c);$("#pagination").append("<a class='ellipsis'>...</a>"),addPageNum(totalPages-1),addPageNum(totalPages)}else if(page>=totalPages-3){addPageNum(1),addPageNum(2),$("#pagination").append("<a class='ellipsis'>...</a>");for(var g=totalPages-(totalPages-page+1);g<=totalPages;g++)addPageNum(g)}else if(page<=3){for(var i=1;i<=page+1;i++)addPageNum(i);$("#pagination").append("<a class='ellipsis'>...</a>"),addPageNum(totalPages-1),addPageNum(totalPages)}if(page<totalPages&&1!=totalPages){var l={categories:categoryquery,tags:tagquery,search:searchquery,per_page:"5",sticky:"true",page:page+1};$("#pagination").append("<a class='page-num' id='page-"+(page+1)+"' href='?"+objectToParams(l)+"'><button class='btn btn-primary'>下</button></a>")}$("#page-"+page+" button").removeClass("btn-primary"),$("#page-"+page+" button").addClass("btn-filled")}else $(".blank-placeholder-posts").css("display","none"),$("#posts-list").append("<h3>没有帖子。点击<a l href='../blog'>这里</a>回博客主页</h3>")}),$("#long-form-submit").on("click",function(a){a.preventDefault();var e=$("#long-email").val();if(validateEmail(e)){subscribeEmail(e,"long-email-subscribe-form");$("#long-email").removeClass("invalid-input"),$("#long-email").addClass("valid-input"),document.getElementById("long-email").setCustomValidity("")}else document.getElementById("long-email").setCustomValidity("电子邮件不正确"),$("#long-email").addClass("invalid-input"),document.getElementById("long-email").reportValidity();return!1}),$("#long-email").on("keydown",function(){document.getElementById("long-email").setCustomValidity("")})});